# CitySimDemo01 (OpenFOAM v9)

ABL wind over city blocks set up for OpenFOAM v9. Geometry lives in `constant/geometry/city_buildings.stl`; `snappyHexMesh` expects the `city_buildings.eMesh` edges generated by `surfaceFeatures` (see run steps below).

## Quick layout
- Mesh: `system/blockMeshDict`, `system/snappyHexMeshDict`, `system/surfaceFeaturesDict`
- Solver: `simpleFoam` (steady RANS, k-Îµ)
- Parallel: `system/decomposeParDict` (default 8 subdomains; change to your core count)

## Run on Ubuntu/WSL (OpenFOAM v9)
1) Install OpenFOAM v9 (Foundation build):
```bash
sudo apt-get update
sudo apt-get install -y software-properties-common
sudo sh -c "wget -O - https://dl.openfoam.org/gpg.key | apt-key add -"
sudo add-apt-repository http://dl.openfoam.org/ubuntu
sudo apt-get update
sudo apt-get install -y openfoam9
```
2) Open an OpenFOAM shell and work from the Linux filesystem (WSL path, e.g. `~/CitySimDemo01` for best performance):
```bash
source /opt/openfoam9/etc/bashrc
cd ~/CitySimDemo01   # copy the case here from /mnt/d if needed
```
3) Generate the mesh and run (always from the case root so `system/blockMeshDict` is visible):
```bash
surfaceFeatures                            # writes constant/geometry/city_buildings.eMesh
blockMesh
snappyHexMesh -overwrite
checkMesh -allTopology -allGeometry
simpleFoam                                  # or:
# decomposePar
# mpirun -np 8 simpleFoam -parallel
# reconstructPar
```
4) Post-process: use `paraFoam` on WSL with an X server, or `foamToVTK` then view in Paraview.

## Run on Google Colab
1) Install OpenFOAM v9 and clone/upload the case in a notebook cell:
```bash
sudo apt-get update
sudo apt-get install -y software-properties-common
sudo sh -c "wget -O - https://dl.openfoam.org/gpg.key | apt-key add -"
sudo add-apt-repository http://dl.openfoam.org/ubuntu
sudo apt-get update
sudo apt-get install -y openfoam9 git
source /opt/openfoam9/etc/bashrc
git clone <your_repo_url> CitySimDemo01 && cd CitySimDemo01   # or unzip your uploaded case
```
2) Run the same commands from the case root:
```bash
surfaceFeatures
blockMesh
snappyHexMesh -overwrite
checkMesh -allTopology -allGeometry
simpleFoam   # or use decomposePar/mpirun if you adjust numberOfSubdomains
```
3) Quick checklist for Colab:
- Ensure the STL is at `constant/geometry/city_buildings.stl`; if you unzipped somewhere else, move it there.
- Run `pwd` to confirm you are in `.../CitySimDemo01` before calling any OpenFOAM utilities (otherwise `system/blockMeshDict` will not be found). Paths in the dicts reference `city_buildings.stl` / `city_buildings.eMesh` and OpenFOAM automatically prepends `constant/geometry/`, so do not add that prefix in the dicts.
- No GUI on Colab: export with `foamToVTK` or `postProcess -func sample` and download the results.

## Notes for v9
- Patch names now match across mesh and fields (`minX`, `maxX`, `sides`, `top`, `ground`, `buildings`).
- Turbulence fields include proper headers/dimensions for OpenFOAM v9 parsing.
- `snappyHexMeshDict` points to `constant/geometry/city_buildings.stl` and the generated `constant/geometry/city_buildings.eMesh`; `surfaceFeaturesDict` is included to build that edge file.
