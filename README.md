# CitySim01 (OpenFOAM v9)

ABL wind over city blocks set up for OpenFOAM v9. Geometry lives in `geometry/city_buildings.stl`; `snappyHexMesh` expects the `city_buildings.eMesh` edges generated by `surfaceFeatureExtract` (see run steps below).

## Quick layout
- Mesh: `system/blockMeshDict`, `system/snappyHexMeshDict`, `system/surfaceFeatureExtractDict`
- Solver: `simpleFoam` (steady RANS, k-Îµ)
- Parallel: `system/decomposeParDict` (default 8 subdomains; change to your core count)

## Run on Ubuntu/WSL (OpenFOAM v9)
1) Install OpenFOAM v9 (Foundation build):
```bash
sudo apt-get update
sudo apt-get install -y software-properties-common
sudo sh -c "wget -O - https://dl.openfoam.org/gpg.key | apt-key add -"
sudo add-apt-repository http://dl.openfoam.org/ubuntu
sudo apt-get update
sudo apt-get install -y openfoam9
```
2) Open an OpenFOAM shell and work from the Linux filesystem (WSL path, e.g. `~/CitySim01` for best performance):
```bash
source /opt/openfoam9/etc/bashrc
cd ~/CitySim01   # copy the case here from /mnt/d if needed
```
3) Generate the mesh and run:
```bash
surfaceFeatureExtract                      # writes geometry/city_buildings.eMesh
blockMesh
snappyHexMesh -overwrite
checkMesh -allTopology -allGeometry
simpleFoam                                  # or:
# decomposePar
# mpirun -np 8 simpleFoam -parallel
# reconstructPar
```
4) Post-process: use `paraFoam` on WSL with an X server, or `foamToVTK` then view in Paraview.

## Run on Google Colab
1) Install OpenFOAM v9 and clone/upload the case in a notebook cell:
```bash
sudo apt-get update
sudo apt-get install -y software-properties-common
sudo sh -c "wget -O - https://dl.openfoam.org/gpg.key | apt-key add -"
sudo add-apt-repository http://dl.openfoam.org/ubuntu
sudo apt-get update
sudo apt-get install -y openfoam9 git
source /opt/openfoam9/etc/bashrc
git clone <your_repo_url> CitySim01 && cd CitySim01   # or unzip your uploaded case
```
2) Run the same commands:
```bash
surfaceFeatureExtract
blockMesh
snappyHexMesh -overwrite
checkMesh -allTopology -allGeometry
simpleFoam   # or use decomposePar/mpirun if you adjust numberOfSubdomains
```
3) No GUI on Colab: export with `foamToVTK` or `postProcess -func sample` and download the results.

## Notes for v9
- Patch names now match across mesh and fields (`minX`, `maxX`, `sides`, `top`, `ground`, `buildings`).
- Turbulence fields include proper headers/dimensions for OpenFOAM v9 parsing.
- `snappyHexMeshDict` points to `geometry/city_buildings.stl` and the generated `geometry/city_buildings.eMesh`; `surfaceFeatureExtractDict` is included to build that edge file.
